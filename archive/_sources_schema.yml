version: 2

sources:
  - name: staging
#    database:
    database: ZACHEE
    schema: STAGING
    tables:
      - name: STG_FINANZGURU
        columns:
          - name: transaction_id
            description: Primary key of the transaction table
            tests:
              - unique
              - not_null
          - name: processing_date
            description: Date of python processing
            tests:
              - not_null
          - name: filename
            description: filename used for export
            tests:
              - not_null
      - name: self_cancelling_transactions
        description: list of self cancelling transactions
        columns:
          - name: transaction_id
            description: Primary key of the transaction table
            tests:
              - unique
              - not_null
          - name: pair_id
            description: Corresponding pair
            tests:
              - not_null
      - name: transaction_id_details
        description: corrected list of transaction details
        columns:
          - name: transaction_id
            description: Primary key of the transaction table
            tests:
              - unique
              - not_null
          - name: txt_category_lvl3
            tests:
              - not_null
          - name: scope_out
            tests:
              - not_null
              - accepted_values:
                  values: ["true", "false"]
          - name: is_transfer
            tests:
              - not_null
              - accepted_values:
                  values: ["true", "false"]

seeds:
  - name: categorytree
    description: Category tree, reworked from L2 of Finanzguru, with IDs, generated by tree2lib library from category_tree_with_ds
    columns:
      - name: DIM_CATEGORY_LVL3
        description: Category ID, id taken from the category_tree_with_ids yaml file
        tests:
          - unique
          - not_null
      - name: TXT_CATEGORY_LVL3
        description: Category name, name should match with FinanzGuru L2 category
        tests:
          - not_null
          - unique
      - name: DIM_CATEGORY_LVL2
        description: Category ID at level 2
        tests:
          - not_null
      - name: TXT_CATEGORY_LVL2
        description: Category description at level 2
        tests:
          - not_null
      - name: DIM_CATEGORY_LVL1
        description: Category ID at level 1
        tests:
          - not_null
      - name: TXT_CATEGORY_LVL1
        description: Category description at level 1, like "Expenses", "Income", "Others"
        tests:
          - not_null
  - name: accounts
    description: list of (masked) iban identifiers to identify personal accounts
    columns:
      - name: account_iban
        description: masked iban
        tests:
          - unique
          - not_null
          - dbt_expectations.expect_column_value_lengths_to_be_between:
              min_value: 10
              max_value: 10
      - name: account_name
        description: account description
        tests:
          - not_null
      - name: preferred_category
        description: preferred category at L3 for this account
        tests:
          - not_null
          - relationships:
              to: ref('categorytree')
              field: TXT_CATEGORY_LVL3
  - name: recurrence_german_to_english
    description: list of german recurrence to english recurrence
    columns:
      - name: recurrence_german
        description: german recurrence
        tests:
          - unique
          - not_null
      - name: recurrence_english
        description: english recurrence
        tests:
          - not_null
  - name: transaction_type_german_to_english
    description: list of german transaction type to english transaction type
    columns:
      - name: transaction_type_german
        description: german transaction type
        tests:
          - unique
          - not_null
      - name: transaction_type_english
        description: english transaction type
        tests:
          - not_null
  - name: income_expense_german_to_engish
    description: list of german income/expense to english income/expense
    columns:
      - name: income_expense_german
        description: german income/expense
        tests:
          - unique
          - not_null
      - name: income_expense_english
        description: english income/expense
        tests:
          - not_null