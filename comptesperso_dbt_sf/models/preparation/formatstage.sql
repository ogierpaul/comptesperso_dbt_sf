SELECT
	TRANSACTION_ID ,
	TO_DATE(DATE_ENREGISTREMENT)AS TRANSACTION_DATE,
	NAME_PERSONAL_ACCOUNT ,
	TO_DECIMAL(MONTANT) AS AMOUNT,
	TO_DECIMAL(SOLDE_COMPTE) AS ACCOUNT_BALANCE,
	BENEFICIAIRE AS BENEFICIARY,
	TRANSACTION_DESCRIPTION ,
	COALESCE(BENEFICIAIRE_IBAN, BENEFICIAIRE_IBAN2) AS BENEFICIARY_IBAN,
	CATEGORIE_L1 AS FINANZGURU_CATEGORY_LVL1,
	CATEGORIE_L2 AS FINANZGURU_CATEGORY_LVL2,
    COALESCE(CONTRAT='ja', FALSE) AS IS_CONTRACT,
	CONTRAT_RECURRENCE  AS CONTRACT_RECURRENCE,
	CONTRAT_ID AS CONTRACT_ID,
	COALESCE(TRANSFER='ja', FALSE) AS IS_TRANSFER ,
    COALESCE(EXCLUS_REVENUS='ja', FALSE) AS SCOPE_OUT,
	TRANSACTION_METHODE AS TRANSACTION_TYPE ,
    REVENUS_DEPENSES AS INCOME_EXPENSE,
	CONCAT(LEFT(PERSONAL_IBAN,2), '****', RIGHT(PERSONAL_IBAN,4)) AS PERSONAL_IBAN,
    FILENAME,
    TO_DATE(PROCESSING_DATE, 'yyyy-MM-dd') AS PROCESSING_DATE,
    FINANZGURU_CATEGORY_LVL2 AS TXT_CATEGORY_LVL3,
    CONCAT(LEFT(BENEFICIARY_IBAN,2), '****', RIGHT(BENEFICIARY_IBAN,4)) as beneficiary_iban_masked
FROM
    {{source('staging_finanzguru', 'STG_FINANZGURU')}}